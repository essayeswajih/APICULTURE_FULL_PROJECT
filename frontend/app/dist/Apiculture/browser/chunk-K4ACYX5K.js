import{Bc as m,I as p,L as c,P as l,k as n,w as s,yc as a}from"./chunk-EPDGJHWN.js";var u={production:!1,apiUrl:"https://apiculturegalai.tn/api"};var h=class r{constructor(e){this.http=e}apiUrl=u.apiUrl+"/auth";tokenKey="access_token";login(e){let t=new a({"Content-Type":"application/x-www-form-urlencoded"}),o=new URLSearchParams;return o.set("username",e.username),o.set("password",e.password),this.http.post(`${this.apiUrl}/token`,o.toString(),{headers:t}).pipe(p(i=>{i.access_token&&localStorage.setItem(this.tokenKey,i.access_token)}),s(this.handleError))}getCurrentUser(){let e=this.getToken();if(!e)return n(()=>new Error("No token found"));let t=new a({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/users/me`,{headers:t}).pipe(s(this.handleError))}getToken(){return localStorage.getItem(this.tokenKey)}isAuthenticated(){return!!this.getToken()}logout(){localStorage.removeItem(this.tokenKey)}handleError(e){let t="An error occurred";return e.status===401?t="Invalid credentials":e.error instanceof ErrorEvent?t=`Client error: ${e.error.message}`:t=`Server error: ${e.status} - ${e.message}`,n(()=>new Error(t))}static \u0275fac=function(t){return new(t||r)(l(m))};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};export{u as a,h as b};

<main class="min-h-screen">
  <!-- Hero Section with Background Image -->
  <section class="hero py-6 text-center bg-light-amber position-relative"  style="background-image: url('/assets/images/pexels-pixabay-301378.jpg'); background-size: cover; background-position:bottom;">
    <div class="container-md">
      <div class="hero-overlay"></div>
      <h1 class="display-3 text-amber mb-4 contact-section">Notre Boutique Apicole</h1>
      <p class="lead text-success mb-0 contact-section">Découvrez notre sélection de matériel apicole et produits de la ruche.</p>
    </div>
  </section>
  <section class="container mt-4">
      <form class="input-group w-50 mx-auto" #newsletterForm="ngForm">
        <input type="email" [(ngModel)]="searchQuery" class="form-control" placeholder="Search for" aria-label="Search">
        <button class="btn btn-warning text-white" type="button" (click)="search()">Search</button>
      </form>
  </section>
  <!-- Filters -->
  <section class="container py-4">
    <div *ngIf="isLoading" class="text-center py-4">
      <div class="spinner-border text-amber" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <div class="d-flex flex-wrap gap-2 mb-3 mb-md-0">
        @for (category of categories; track trackByCategoryId($index, category)) {
          <button
            class="btn btncategory"
            role="button"
            [ngClass]="{
              'btn-warning text-light': selectedCategory.id === category.id,
              'btn-outline-warning': selectedCategory.id !== category.id
            }"
            (click)="selectCategory(category)"
            [attr.aria-pressed]="selectedCategory.id === category.id"
            [attr.aria-label]="'Filter by category ' + category.name"
          >
            {{ category.name }}
          </button>
        }
      </div>
      <select
        class="form-select w-auto border border-amber text-amber bg-light-amber"
        [(ngModel)]="sortBy"
        (ngModelChange)="changeSortBy($event)"
        aria-label="Sort products"
      >
        <option value="popularite">Trier par popularité</option>
        <option value="prix-asc">Prix : croissant</option>
        <option value="prix-desc">Prix : décroissant</option>
      </select>
    </div>

    <!-- Product Grid -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
      @for (product of products; track trackByProductId($index, product)) {
        <div class="col">
          <div class="card h-100 product-card">
               @if(product.promo){
                  <div style="position:absolute;z-index:100"><img src="/assets/images/promo.png" style="height: 60px;" alt="promo" srcset=""></div>
                }
            <img 
              [src]="product.image_url || '/assets/images/placeholder.jpg'" 
              class="card-img-top" 
              [alt]="product.name"
              (click)="goToProduct(product.id)"
              style="width: 100%; height: 100%; padding: 20px; cursor: pointer;"
              loading="lazy"
            >
             <div style="position:absolute!important;background-color:rgb(226, 75, 28);color:white;font-weight:bold;top:3%;right:0;padding-left:5px;padding-right:5px">{{product.buzzent}}</div>
            <div class="card-body">
              <h5 
                class="card-title text-success" 
                (click)="goToProduct(product.id)"
                style="cursor: pointer;"
              >
                {{ product.name }}
              </h5>
                     @if(product.discounted_price && product.discounted_price < product.price) {
                        <span class="d-block" style="margin-bottom: 5px;">     
                          <p class="card-text text-danger" style="display: inline-block !important; margin-right:5px;">{{ product.discounted_price }} DT</p>    
                          <p class="card-text text-decoration-line-through" style="display: inline-block !important;font-size:0.8em !important;height: 10px !important;">{{ product.price }} DT</p>
                        </span>

                      } @else {
                        <span class="d-block" style="margin-bottom: 5px;">      
                          <p class="card-text text-danger" style="display: inline-block !important;">{{ product.price }} DT</p>
                        </span>
                      }
              <button 
                class="btn btn-warning w-100 text-light hover-dark-green"
                (click)="addToCart(product)"
                [disabled]="isLoading">
                Ajouter au panier
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  </section>
</main>